<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Predplatné Kalkulačka</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "recharts": "https://esm.sh/recharts@2.12.0?external=react,react-dom",
        "lucide-react": "https://esm.sh/lucide-react@0.344.0?external=react,react-dom"
      }
    }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Drobné úpravy animácií */
        .animate-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50">

    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell, LabelList } from 'recharts';
        import { Calculator, Zap, PiggyBank, Sparkles, Gamepad2, Cloud, Youtube } from 'lucide-react';

        // --- ZAČIATOK TVOJHO KÓDU ---

        // Upravený komponent Card
        const Card = ({ children, className = "" }) => {
          const defaultBg = className.includes('bg-') ? '' : 'bg-white';
          return (
            <div className={`rounded-xl shadow-md p-6 ${defaultBg} ${className}`}>
              {children}
            </div>
          );
        };

        // Definícia služieb
        const SERVICES_DB = [
          {
            id: 'youtube',
            name: 'YouTube & Music',
            icon: Youtube,
            color: '#ff0000',
            plans: [
              { id: 'none', name: 'Žiadne predplatné', monthly: 0, yearly: 0 },
              { id: 'yt_premium_ind', name: 'Premium (Jednotlivec)', monthly: 7.19, yearly: null },
              { id: 'yt_premium_fam', name: 'Premium (Rodina)', monthly: 10.99, yearly: null },
              { id: 'yt_premium_student', name: 'Premium (Študent)', monthly: 4.19, yearly: null },
              { id: 'yt_music', name: 'Music Premium', monthly: 5.99, yearly: null },
            ]
          },
          {
            id: 'google_one',
            name: 'Google One (Úložisko & AI)',
            icon: Cloud,
            color: '#34a853',
            plans: [
              { id: 'none', name: '15 GB (Zadarmo)', monthly: 0, yearly: 0 },
              { id: 'basic_100', name: 'Basic 100 GB', monthly: 1.99, yearly: 19.99 },
              { id: 'standard_200', name: 'Standard 200 GB', monthly: 2.99, yearly: 29.99 },
              { id: 'premium_2tb', name: 'Premium 2 TB', monthly: 9.99, yearly: 99.99 },
              { id: 'ai_premium_2tb', name: 'AI Premium 2 TB (Gemini)', monthly: 21.99, yearly: null },
            ]
          },
          {
            id: 'play_pass',
            name: 'Google Play Pass',
            icon: Gamepad2,
            color: '#fbbc04',
            plans: [
              { id: 'none', name: 'Neaktívne', monthly: 0, yearly: 0 },
              { id: 'play_pass_std', name: 'Play Pass', monthly: 4.99, yearly: 29.99 },
            ]
          }
        ];

        const App = () => {
          // State pre výber používateľa
          const [selections, setSelections] = useState(() => {
            const initial = {};
            SERVICES_DB.forEach(service => {
              initial[service.id] = { planId: 'none', billing: 'monthly' };
            });
            // Default setup
            initial['youtube'] = { planId: 'yt_premium_fam', billing: 'monthly' };
            initial['google_one'] = { planId: 'premium_2tb', billing: 'monthly' };
            initial['play_pass'] = { planId: 'play_pass_std', billing: 'monthly' };
            return initial;
          });

          // AI State
          const [aiAnalysis, setAiAnalysis] = useState('');
          const [isAnalyzing, setIsAnalyzing] = useState(false);
          const [aiError, setAiError] = useState('');

          // Update selection handler
          const updateSelection = (serviceId, field, value) => {
            setSelections(prev => ({
              ...prev,
              [serviceId]: {
                ...prev[serviceId],
                [field]: value
              }
            }));
          };

          // Calculations
          const calculateTotals = () => {
            let monthlyTotal = 0;
            let yearlyTotal = 0;
            let optimizedYearlyTotal = 0;
            
            let breakdown = [];

            SERVICES_DB.forEach(service => {
              const sel = selections[service.id];
              const plan = service.plans.find(p => p.id === sel.planId);
              
              if (plan && plan.id !== 'none') {
                let cost = 0;
                let yearlyCostOpt = 0;

                // Calculate actual current cost based on selection
                if (sel.billing === 'yearly' && plan.yearly) {
                  cost = plan.yearly / 12; // Amortized monthly
                  yearlyTotal += plan.yearly;
                } else {
                  cost = plan.monthly;
                  yearlyTotal += plan.monthly * 12;
                }

                // Calculate optimized cost (if yearly is available, assume yearly)
                if (plan.yearly) {
                  yearlyCostOpt = plan.yearly;
                } else {
                  yearlyCostOpt = plan.monthly * 12;
                }
                optimizedYearlyTotal += yearlyCostOpt;

                monthlyTotal += cost;
                
                breakdown.push({
                  id: service.id,
                  name: service.name,
                  value: cost,
                  color: service.color,
                  billing: sel.billing,
                  canOptimize: sel.billing === 'monthly' && plan.yearly !== null
                });
              }
            });

            return { monthlyTotal, yearlyTotal, optimizedYearlyTotal, breakdown };
          };

          const stats = calculateTotals();
          const yearlySavingsPotential = stats.yearlyTotal - stats.optimizedYearlyTotal;

          // Chart Data Preparation
          const getShortName = (id) => {
            switch(id) {
              case 'youtube': return 'YouTube';
              case 'google_one': return 'Google One';
              case 'play_pass': return 'Play Pass';
              default: return 'Služba';
            }
          };

          const chartData = [
            ...stats.breakdown.map(item => ({
              name: getShortName(item.id),
              cena: parseFloat(item.value.toFixed(2)),
              fill: item.color
            })),
            {
              name: 'SPOLU',
              cena: parseFloat(stats.monthlyTotal.toFixed(2)),
              fill: '#1f2937'
            }
          ];

          // Gemini Analysis
          const analyzeWithGemini = async () => {
            setIsAnalyzing(true);
            setAiAnalysis('');
            setAiError('');

            // POZNÁMKA: Tu by mal byť tvoj API kľúč, ak ho chceš používať. 
            // Pre publikovanie na webe je riskantné dávať sem kľúč verejne.
            const apiKey = ""; 
            
            const activeServices = SERVICES_DB.map(s => {
              const sel = selections[s.id];
              const plan = s.plans.find(p => p.id === sel.planId);
              if (plan.id === 'none') return null;
              return `- ${s.name}: ${plan.name} (${sel.billing === 'yearly' ? 'Ročne' : 'Mesačne'})`;
            }).filter(Boolean).join('\n');

            const prompt = `
              Act as a smart subscription manager for Google services.
              Analyze this user's configuration in Slovakia.

              User's Stack:
              ${activeServices}

              Financials:
              - Total Monthly Avg Cost: €${stats.monthlyTotal.toFixed(2)}
              - Total Yearly Spend: €${stats.yearlyTotal.toFixed(2)}
              - Potential Savings (if switched to yearly): €${yearlySavingsPotential.toFixed(2)}

              Task:
              Provide a strategic analysis in Slovak language (max 4 sentences).
              1. Comment on the mix of services (e.g., "Máte silný ekosystém...").
              2. If they have 'AI Premium', highlight the value of Gemini Advanced.
              3. If they have monthly plans that support yearly billing, STRONGLY recommend switching.
              4. Use emojis.
            `;

            try {
              if (!apiKey) throw new Error("Chýba API kľúč");

              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
                }
              );

              if (!response.ok) throw new Error('Chyba AI');
              const data = await response.json();
              const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
              if (text) setAiAnalysis(text);
              else throw new Error('Žiadna odpoveď');

            } catch (error) {
              setAiAnalysis(error.message === "Chýba API kľúč" ? "Pre AI analýzu je potrebné vložiť API kľúč do kódu." : 'AI momentálne nedostupná.');
            } finally {
              setIsAnalyzing(false);
            }
          };

          useEffect(() => { setAiAnalysis(''); }, [selections]);

          return (
            <div className="p-4 max-w-5xl mx-auto bg-gray-50 min-h-screen font-sans">
              <div className="mb-8 text-center">
                <h1 className="text-3xl font-bold text-gray-800 mb-2">Google Predplatné: Konfigurátor</h1>
                <p className="text-gray-600">Analyzuj ľubovoľnú kombináciu služieb a nájdi optimálne nastavenie</p>
              </div>

              <div className="grid lg:grid-cols-3 gap-6 mb-6">
                
                {/* LEFT COLUMN: Service Selector */}
                <div className="lg:col-span-2 space-y-4">
                  <Card className="border-t-4 border-blue-500">
                    <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                      <Zap className="text-blue-500" /> Výber služieb
                    </h2>
                    
                    <div className="space-y-6">
                      {SERVICES_DB.map((service) => {
                        const currentSelection = selections[service.id];
                        const currentPlan = service.plans.find(p => p.id === currentSelection.planId);
                        const isSelected = currentSelection.planId !== 'none';
                        
                        return (
                          <div key={service.id} className={`p-4 rounded-xl border transition-all ${isSelected ? 'bg-white border-blue-200 shadow-sm' : 'bg-gray-50 border-gray-100 opacity-80 hover:opacity-100'}`}>
                            <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                              
                              {/* Header */}
                              <div className="flex items-center gap-3 min-w-[200px]">
                                <div className={`p-2 rounded-lg text-white`} style={{ backgroundColor: service.color }}>
                                  <service.icon size={20} />
                                </div>
                                <span className="font-semibold text-gray-700">{service.name}</span>
                              </div>

                              {/* Controls */}
                              <div className="flex flex-wrap items-center gap-3 flex-1 justify-end">
                                <select 
                                  className="bg-white border border-gray-300 text-gray-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 min-w-[180px]"
                                  value={currentSelection.planId}
                                  onChange={(e) => updateSelection(service.id, 'planId', e.target.value)}
                                >
                                  {service.plans.map(plan => (
                                    <option key={plan.id} value={plan.id}>
                                      {plan.name} {plan.id !== 'none' ? `(€${plan.monthly}/mes)` : ''}
                                    </option>
                                  ))}
                                </select>

                                {/* Billing Toggle */}
                                {isSelected && currentPlan.yearly !== null && (
                                  <div className="flex items-center bg-gray-100 rounded-lg p-1">
                                    <button
                                      onClick={() => updateSelection(service.id, 'billing', 'monthly')}
                                      className={`px-3 py-1.5 text-xs font-medium rounded-md transition-all ${currentSelection.billing === 'monthly' ? 'bg-white shadow text-gray-800' : 'text-gray-500'}`}
                                    >
                                      Mesačne
                                    </button>
                                    <button
                                      onClick={() => updateSelection(service.id, 'billing', 'yearly')}
                                      className={`px-3 py-1.5 text-xs font-medium rounded-md transition-all ${currentSelection.billing === 'yearly' ? 'bg-green-100 text-green-700' : 'text-gray-500'}`}
                                    >
                                      Ročne (-17%)
                                    </button>
                                  </div>
                                )}
                                 {isSelected && currentPlan.yearly === null && (
                                    <span className="text-xs text-gray-400 px-2">Len mesačne</span>
                                 )}
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </Card>

                  {/* AI Section */}
                  <Card className="bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-100">
                     <div className="flex justify-between items-center mb-3">
                        <div className="flex items-center gap-2 text-purple-800 font-bold">
                            <Sparkles className="w-5 h-5" /> AI Optimalizátor
                        </div>
                        <button 
                            onClick={analyzeWithGemini}
                            disabled={isAnalyzing}
                            className="text-xs bg-purple-600 text-white px-3 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50 transition-colors"
                        >
                            {isAnalyzing ? 'Analyzujem...' : 'Analyzovať zloženie'}
                        </button>
                     </div>
                     {aiAnalysis && (
                        <div className="bg-white/80 p-3 rounded-lg text-sm text-gray-800 italic animate-in">
                            {aiAnalysis}
                        </div>
                     )}
                  </Card>
                </div>

                {/* RIGHT COLUMN: Summary & Stats */}
                <div className="space-y-4">
                  
                  {/* Total Cost Card */}
                  <Card className="bg-gray-900 text-white border-none relative overflow-hidden">
                    <div className="relative z-10">
                        <p className="text-gray-400 text-xs uppercase tracking-wider font-semibold">Mesačný priemer</p>
                        <h3 className="text-5xl font-bold my-2">€{stats.monthlyTotal.toFixed(2)}</h3>
                        <div className="flex justify-between items-end border-t border-gray-700 pt-3 mt-3">
                            <div>
                                <p className="text-gray-400 text-xs">Ročné náklady</p>
                                <p className="font-semibold">€{stats.yearlyTotal.toFixed(2)}</p>
                            </div>
                            {yearlySavingsPotential > 1 && (
                                 <div className="text-right">
                                    <p className="text-green-400 text-xs">Možná úspora</p>
                                    <p className="font-bold text-green-400">€{yearlySavingsPotential.toFixed(2)} /rok</p>
                                 </div>
                            )}
                        </div>
                    </div>
                    {/* Decoration */}
                    <div className="absolute right-0 top-0 opacity-10 transform translate-x-10 -translate-y-10">
                        <Calculator size={150} />
                    </div>
                  </Card>

                  {/* Recommendations List */}
                  {stats.breakdown.some(i => i.canOptimize) && (
                      <Card className="border-l-4 border-green-500 bg-green-50">
                        <h4 className="font-bold text-green-800 text-sm mb-2 flex items-center gap-2">
                            <PiggyBank size={16} /> Tip na úsporu
                        </h4>
                        <ul className="text-xs text-green-700 space-y-1">
                            {stats.breakdown.filter(i => i.canOptimize).map(item => (
                                <li key={item.name}>
                                    • Prepnite <b>{item.name}</b> na ročnú platbu.
                                </li>
                            ))}
                        </ul>
                      </Card>
                  )}
                </div>
              </div>

               {/* FULL WIDTH CHART */}
               {stats.breakdown.length > 0 && (
                    <Card className="w-full">
                      <h3 className="font-bold text-gray-700 mb-4 text-lg">Porovnanie mesačných nákladov</h3>
                      <div className="h-64 w-full">
                        <ResponsiveContainer width="100%" height="100%">
                          <BarChart data={chartData} layout="vertical" margin={{ top: 5, right: 60, left: 20, bottom: 5 }}>
                            <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                            <XAxis type="number" unit="€" domain={[0, 'auto']} />
                            <YAxis dataKey="name" type="category" width={100} tick={{fontSize: 12, fontWeight: 500}} />
                            <Tooltip 
                                formatter={(value) => [`€${value}`, 'Cena']}
                                contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}
                            />
                            <Bar dataKey="cena" radius={[0, 4, 4, 0]} barSize={40}>
                              {chartData.map((entry, index) => (
                                <Cell key={`cell-${index}`} fill={entry.fill} />
                              ))}
                              <LabelList 
                                dataKey="cena" 
                                position="right" 
                                formatter={(val) => `€${val}`} 
                                style={{ fontSize: '13px', fill: '#666', fontWeight: 600 }} 
                              />
                            </Bar>
                          </BarChart>
                        </ResponsiveContainer>
                      </div>
                    </Card>
                 )}
            </div>
          );
        };

        // --- KONIEC TVOJHO KÓDU ---

        // Vykreslenie aplikácie do stránky
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>